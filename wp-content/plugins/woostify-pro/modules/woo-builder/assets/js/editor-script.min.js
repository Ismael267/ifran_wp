"use strict";var woostifySearchDelay=function(t){return void 0===t&&(t=0),function(e,o){clearTimeout(t),t=setTimeout(e,o)}}(),woostifySelectProductPreview=function(e){NProgress.start();e={action:"woo_builder_select_product_preview",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,selected_id:e},e=new URLSearchParams(e).toString(),e=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:e,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(e).then(function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()}).then(function(e){e.success}).catch(function(e){console.log(e)}).finally(function(){"undefined"!=typeof elementor&&elementor.reloadPreview(),NProgress.done()})},woostifyWooBuilderPreview=function(){var r=document.getElementById("elementor-panel-footer-tools");if(r){window.wooBuilderOpen=null;var s,a,c,e=r.querySelector("#elementor-panel-footer-saver-preview");e&&woostify_woo_builder_editor.is_product_template&&(e.setAttribute("id","woostify-tool-preview-button"),(s=r.querySelector("#elementor-panel-footer-saver-preview-label"))&&(o="",o+='<div class="woostify-preview-settings-wrap">',o+='<div class="woostify-preview-settings-inner">',o+='<div class="woostify-preview-search">',o+='<div class="woostify-preview-search-result"></div>',o+='<input class="woostify-preview-search-field" placeholder="'+woostify_woo_builder_editor.search_placeholder+'">',o+="</div>",o+='<span class="woostify-preview-value" data-url>'+woostify_woo_builder_editor.select_preview+"</span>",o+='<span class="woostify-preview-button">'+woostify_woo_builder_editor.preview_text+"</span>",o+="</div>",s.insertAdjacentHTML("afterend",o+="</div>"),c=a=0,s.onclick=function(e){e.preventDefault(),0==c?(c=1,document.body.classList.add("hide-elementor-tooltip"),s.parentNode.classList.add("elementor-open")):(c=0,document.body.classList.remove("hide-elementor-tooltip"),s.parentNode.classList.remove("elementor-open"));var e=r.querySelector(".woostify-preview-settings-wrap"),t=e.querySelector(".woostify-preview-value"),o=e.querySelector(".woostify-preview-search"),i=e.querySelector(".woostify-preview-search-field"),n=e.querySelector(".woostify-preview-search-result"),e=e.querySelector(".woostify-preview-button");t&&(t.onclick=function(){o&&(0==a?(a=1,o.classList.add("active")):(a=0,o.classList.remove("active"))),i&&(i.focus(),i.oninput=function(){var o=i.value.trim();o&&n?woostifySearchDelay(function(){n&&(n.innerHTML='<span class="result-item">'+woostify_woo_builder_editor.searching_text+"</span>");var e={action:"woo_builder_preview_search_data",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,keyword:o},e=new URLSearchParams(e).toString(),e=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:e,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(e).then(function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()}).then(function(e){e.success&&n&&(n.innerHTML=e.data.content)}).catch(function(e){console.log(e)}).finally(function(){var e=n?n.querySelectorAll(".result-item"):[];e.length&&e.forEach(function(o){o.onclick=function(){var e=o.getAttribute("data-url");e&&t&&(t.innerHTML=o.innerHTML,t.setAttribute("data-url",e),(e=o.getAttribute("data-id"))&&woostifySelectProductPreview(e),t.click())}})})},500):n.innerHTML=""})}),e&&(e.onclick=function(){var e=(e=t?t.getAttribute("data-url"):"")||woostify_woo_builder_editor.preview_url;window.wooBuilderOpen&&window.wooBuilderOpen.parent&&e===window.wooBuilderOpen.location.href?window.wooBuilderOpen.focus():window.wooBuilderOpen=window.open(e,"_blank")})}));var o,l,e=r.querySelector("#elementor-panel-footer-sub-menu-item-save-template");e&&(e.insertAdjacentHTML("beforebegin",'<div id="woostify-tool-display-conditions" class="elementor-panel-footer-sub-menu-item"><i class="elementor-icon eicon-flow" aria-hidden="true"></i><div class="elementor-title">'+woostify_woo_builder_editor.condition_text+"</div></div>"),o=document.getElementById("elementor-preview"),i=r.querySelector("#woostify-tool-display-conditions"),e=document.getElementById("woostify-woobuilder-conditions-html"),o&&e&&o.insertAdjacentHTML("afterend",e.innerHTML),l=document.querySelector(".woostify-woobuilder-conditions"),i&&l&&(i.onclick=function(e){e.preventDefault(),l.classList.add("active");function o(){l.classList.remove("active")}l.onclick=function(e){this===e.target&&o()};e=l.querySelector(".woostify-woobuilder-conditions-close-btn");e&&(e.onclick=o),document.body.addEventListener("keyup",function(e){27===e.keyCode&&o()});function t(){var e=document.querySelectorAll(".woostify-woobuilder-conditions .woostify-condition-item-remove");e.length&&e.forEach(function(o){o.onclick=function(){var e=o.parentNode;(e.nextElementSibling||e.previousElementSibling)&&e.remove()}})}var i,e=l.querySelector(".woostify-woobuilder-conditions-content-inner"),n=!!e&&e.querySelector(".woostify-woobuilder-condition-item-wrapper"),e=!!e&&e.querySelector(".woostify-condition-add-button");t(),e&&(i=e.getAttribute("data-type")||"",e.onclick=function(){var e=document.getElementById("woostify-woobuilder-conditions-"+i+"-html");e&&n&&n.insertAdjacentHTML("beforeend",e.innerHTML),t(),d()})}));var t=document.getElementById("elementor-panel-saver-button-publish");if(t&&"publish"!=woostify_woo_builder_editor.post_status){t.insertAdjacentHTML("beforebegin",'<button id="woostify-panel-saver-button-publish" class="elementor-button elementor-button-success">'+t.innerHTML+"</button>");var i=document.getElementById("woostify-panel-saver-button-publish");if(!i)return;i.onclick=function(e){var o;this.classList.contains("elementor-disabled")||(o=document.getElementById("woostify-tool-display-conditions"))&&o.click()}}var d=function(){var e;!l||(e=l.querySelectorAll(".woostify-condition-item")).length&&e.forEach(function(e){var n=e.querySelector(".woostify-condition-item-field"),o=e.querySelector(".woostify-condition-item-search-view");n&&(n.onchange=function(){["in-cat","in-tag"].includes(n.value)?e.classList.add("has-search-field"):(e.classList.remove("has-search-field"),o&&(o.setAttribute("data-id","all"),o.innerHTML=woostify_woo_builder_editor.all_text))});var r,i,s=e.querySelector(".woostify-condition-item-search");s&&(r=s.querySelector(".woostify-condition-item-search-field"),i=0,s.onclick=function(e){var o=this,t=o.closest(".woostify-woobuilder-condition-item-wrapper"),t=t?t.querySelectorAll(".woostify-condition-item-search.active"):[];e.target!==r&&(t.length&&t.forEach(function(e){e!==o&&e.classList.remove("active")}),0==i?(o.classList.add("active"),i=1,r&&r.focus()):(i=0,o.classList.remove("active")),document.onclick=function(e){e=e.target;e!==o&&e!==r&&(i=0,s.classList.remove("active"))})},r&&(r.oninput=function(){var t=s.querySelector(".woostify-condition-item-search-view"),o=r.value.trim(),i=s.querySelector(".woostify-condition-item-search-result");o&&i?woostifySearchDelay(function(){i&&(i.innerHTML='<span class="result-item">'+woostify_woo_builder_editor.searching_text+"</span>");var e={action:"woo_builder_conditions_search_data",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,field_value:n.value,keyword:o},e=new URLSearchParams(e).toString(),e=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:e,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(e).then(function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()}).then(function(e){e.success&&(e=e.data,i&&(i.innerHTML=e.content))}).catch(function(e){console.log(e)}).finally(function(){var e=i?i.querySelectorAll(".result-item"):[];e.length&&e.forEach(function(o){o.onclick=function(){var e=o.getAttribute("data-id");e&&t&&(t.innerHTML=o.innerHTML,t.setAttribute("data-id",e))}})})},500):i.innerHTML=""}))})};d();var n;!l||(n=l.querySelector(".save-options"))&&(n.onclick=function(){var e,n,o=l.querySelectorAll(".woostify-condition-item");o.length&&(NProgress.start(),l.click(),t&&t.classList.add("elementor-button-state"),(e=document.getElementById("woostify-panel-saver-button-publish"))&&e.classList.add("disabled","elementor-button-state"),n=[],o.forEach(function(e,o){var t=e.querySelector(".woostify-condition-item-type"),i=e.querySelector(".woostify-condition-item-field"),e=e.querySelector(".woostify-condition-item-search-view"),e=e?e.getAttribute("data-id"):"all";t&&i&&n.push({data_type:t.value,data_field:i.value,data_id:e})}),o={action:"save_woo_builder_conditions",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,conditions:JSON.stringify(n)},o=new URLSearchParams(o).toString(),o=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:o,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})}),fetch(o).then(function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()}).then(function(e){e.success}).catch(function(e){console.log(e)}).finally(function(){t&&(t.classList.remove("elementor-button-state"),t.click()),e&&e.classList.remove("elementor-button-state"),NProgress.done()}))}),elementor.saver.on("after:save",function(e){window.wooBuilderOpen&&window.wooBuilderOpen.parent&&window.wooBuilderOpen.location.reload()})}};window.addEventListener("load",function(){woostifyWooBuilderPreview()});